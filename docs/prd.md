# Tran PRD (Product Requirements Document)

> **B2B 의료기기 유통 관리 시스템**
> Version: 2.0
> Last Updated: 2025-01-22

---

## Executive Summary

Tran은 의료기기 유통업체를 위한 B2B 거래 관리 시스템입니다. 병원-본사-도매 간의 견적, 발주, 구매, 판매, 재고, 채권 관리를 통합하여 업무 효율성을 극대화합니다.

### Target Users
- **병원**: 발주 요청, 납품 확인
- **본사**: 전체 거래 관리, 단가 정책
- **도매/물류**: 출고, 배송 관리
- **관리자**: 권한, 정산 관리

### Key Differentiators
- **상태 기반 워크플로우**: 모든 문서가 상태 머신으로 관리
- **자동 연계**: 발주→구매→입고→판매→출고 자동 흐름
- **단가 보안**: 거래처별 단가 완전 분리 (Private)

---

## 0. 공통 UX 원칙

### 0.1 UI 구현 단계

> **Phase 1 (초기)**: 거래처 고정 모드 - 단일 거래처 컨텍스트 잠금
> **Phase 2 (향후)**: 탭 기반 MDI - 다중 거래처 동시 작업 (ADR-001 참조)

---

### 0.2 Phase 1: 거래처 고정 모드 (현재 구현 대상)

#### 핵심 원칙
> **거래처 선택 → 전체 화면 고정 → 명시적 전환**

거래처를 선택하면 모든 작업 화면(발주/견적/구매/판매/재고)이 해당 거래처로 고정됩니다.
다른 거래처로 전환하려면 명시적으로 [거래처 변경] 버튼을 클릭해야 합니다.

#### 화면 구조

```
┌─────────────────────────────────────────────────────────────────┐
│  [현재 거래처: A병원 ▼]                          [거래처 변경]   │
├─────────────────────────────────────────────────────────────────┤
│  [발주]  [견적]  [구매]  [판매]  [재고]                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│              (선택된 업무 카테고리의 콘텐츠 영역)                 │
│              (모든 데이터는 현재 거래처 기준으로 필터)            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 거래처 선택/변경 흐름

| 동작 | 설명 |
|------|------|
| **앱 시작** | 거래처 선택 화면 표시 (2컬럼 카드 리스트) |
| **거래처 카드 클릭** | 해당 거래처로 전체 화면 고정, 업무 카테고리 탭 활성화 |
| **[거래처 변경] 클릭** | 미저장 확인 → 거래처 선택 화면으로 복귀 |
| **[현재 거래처 ▼] 클릭** | 최근 거래처 드롭다운 (빠른 전환) |

#### 거래처 변경 시 미저장 확인

```
┌─────────────────────────────────────────┐
│  ⚠️ 작업 중인 데이터가 있습니다         │
│                                          │
│  현재 작업 중인 임시저장 데이터가        │
│  있습니다. 어떻게 하시겠습니까?          │
│                                          │
│  [임시저장 후 전환]  [저장 안 함]  [취소] │
└─────────────────────────────────────────┘
```

#### 거래처 선택 화면 (2컬럼 리스트)

```
┌─────────────────────────────────────────────────────────────────┐
│  거래처 선택                                                     │
├─────────────────────────────────────────────────────────────────┤
│ 🔍 [업체명 검색...]                        [유형 ▼] [정렬 ▼]   │
├─────────────────────────┬───────────────────────────────────────┤
│  🏥 A병원               │  🏥 B의원                             │
│  서울시 강남구          │  서울시 서초구                        │
│  최근거래: 2025-01-22   │  최근거래: 2025-01-20                 │
├─────────────────────────┼───────────────────────────────────────┤
│  🏢 C도매               │  🏢 D본사                             │
│  경기도 성남시          │  부산시 해운대구                      │
│  최근거래: 2025-01-18   │  최근거래: 2025-01-15                 │
└─────────────────────────┴───────────────────────────────────────┘
```

### 0.3 거래처 상세화면 (3분할 레이아웃)

거래처 선택 후, 각 업무 카테고리(발주/견적/구매/판매)에서 동일한 3분할 레이아웃 적용:

```
┌─────────────────────────────────────────────────────────────────┐
│  [현재 거래처: A병원 ▼]                          [거래처 변경]   │
├─────────────────────────────────────────────────────────────────┤
│  [발주]  [견적]  [구매]  [판매]  [재고]                          │
├───────────────────────────────┬─────────────────────────────────┤
│  📦 품목 리스트               │  ⭐ 최근거래 품목                │
│  [품목 검색...]               │  자주 시키는 품목 (최근 30일)   │
│  ☐ 테이프 10EA    ₩3,500     │  ☑ 테이프 10EA  수량: [__100_]  │
│  ☐ 거즈 1BOX      ₩12,000    │  ☑ 거즈 1BOX    수량: [___50_]  │
│  ☐ 주사기 100EA   ₩8,000     │  ────────────────────────────   │
│  ...                          │  합계: ₩950,000                 │
│                               │  [임시저장]  [발주서 보내기]    │
├───────────────────────────────┴─────────────────────────────────┤
│  📋 최근 거래 내역                                               │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ [등록]  [최근 작업 (임시저장)]  [최근 성사 내역]           │  │
│  └───────────────────────────────────────────────────────────┘  │
│  (선택된 탭의 내용)                                              │
└─────────────────────────────────────────────────────────────────┘
```

| 영역 | 위치 | 설명 |
|------|------|------|
| **품목 리스트** | 좌상단 | 해당 거래처의 품목 목록, 검색/필터 |
| **최근거래 품목** | 우상단 | 해당 거래처와 자주 거래하는 품목, 수량 입력 → 발주/판매 작성 |
| **최근 거래 내역** | 하단 | 해당 거래처의 3개 탭: 등록, 최근작업(임시저장), 성사내역 |

### 0.4 작업 흐름 (Workflow)

```
① 거래처 선택  →  ② 업무 카테고리 선택  →  ③ 품목/수량 입력  →  ④ 임시저장
       ↓                   ↓                       ↓                    ↓
  [전체 화면 고정]   [발주/견적/구매/         [최근거래 품목에서    [최근 작업 탭에
                      판매/재고 택1]           수량만 입력]          자동 반영]
                                                    ↓
                              ⑤ 불러오기    →    ⑥ 발주서 보내기
                                   ↓                    ↓
                            [최근 작업에서         [발주 확정]
                             임시저장 선택]        [성사 내역에 반영]
```

### 0.5 Phase 2: 탭 기반 MDI (향후 확장)

> Phase 1의 `CurrentCompany` 전역 상태를 탭별 상태로 분리하여 확장.
> 상세 설계: `docs/TABBED_MDI_UI_UX_GUIDE.md`, ADR-001 참조.

```
┌─────────────────────────────────────────────────────────────────┐
│  [발주관리]  [판매관리]  [재고관리]  [정산관리]  ...             │
├─────────────────────────────────────────────────────────────────┤
│  [+ 거래처 선택]  [A병원 ✕]  [B의원 ✕]  [C병원 ✕]               │
├─────────────────────────────────────────────────────────────────┤
│                    (선택된 탭의 콘텐츠 영역)                     │
└─────────────────────────────────────────────────────────────────┘
```

### 0.6 데이터 변경 하이라이트
| 상태 | 색상 | Hex Code | 용도 |
|------|------|----------|------|
| **신규** | 초록 | `#E6F4EA` / `#1E7F34` | 새로 추가된 데이터 |
| **수정** | 노랑 | `#FFF4E5` / `#E67700` | 변경된 데이터 |
| **취소/무효** | 회색 | `#F0F0F0` / `#555555` | 취소/무효 처리된 데이터 |

### 0.7 공통 리스트 기능
- **필터**: 날짜(범위), 거래처, 품목, 상태
- **검색**: 통합 검색 (업체명)
- **내보내기**: Excel, PDF (Premium)
- **페이지네이션**: 50건/페이지 기본

---

## 1. 서류 관리 (문서 중심)

### 1.1 견적서 (Quotation)

#### 1.1.1 견적서 입력
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 거래처 | Select | ✓ | 거래처 목록에서 선택 |
| 품목 | Multi-Select | ✓ | 품목 추가 (복수) |
| 수량 | Number | ✓ | 품목별 수량 |
| 단가 | Currency | ✓ | 품목별 단가 |
| 유효기간 | Date | ✓ | 견적 만료일 |
| 담당자 | Select | ✓ | 담당자 선택 |
| 비고 | Text | - | 추가 메모 |

#### 1.1.2 견적서 상태 머신
```
┌─────────┐    발송     ┌─────────┐    검토     ┌──────────────┐
│  작성   │ ─────────▶ │  발송   │ ─────────▶ │ 수신 검토중  │
└─────────┘            └─────────┘            └──────────────┘
                                                    │
                                    ┌───────────────┼───────────────┐
                                    ▼               │               ▼
                              ┌─────────┐          │         ┌───────────┐
                              │  확정   │◀─────────┴────────▶│ 수정요청  │
                              └─────────┘                    └───────────┘
                                    │                              │
                                    ▼                              ▼
                           단가 정책 반영                    견적서 재작성
                           품목 리스트 등록
```

| 상태 | 설명 | 다음 상태 |
|------|------|-----------|
| 작성 (Draft) | 견적서 작성 중 | 발송 |
| 발송 (Sent) | 거래처에 견적서 발송 | 수신 검토중 |
| 수신 검토중 (UnderReview) | 거래처에서 검토 중 | 확정 / 수정요청 |
| 확정 (Confirmed) | 견적 승인 완료 | Terminal |
| 수정요청 (RevisionRequested) | 수정 필요 | 작성 (새 버전) |

#### 1.1.3 견적 확정 시 동작
```yaml
On Confirm:
  1. 단가 정책 반영:
     - 해당 거래처의 품목별 단가 업데이트
     - 단가 이력 저장

  2. 품목 리스트 등록:
     - 거래처별 품목 리스트에 자동 추가
     - 예: A상사, 테이프 10개, 단가 3,500원

  3. 발주/판매 연계:
     - 해당 품목을 발주, 판매, 재고에서 사용 가능
```

#### 1.1.4 기존 견적 불러오기
- 거래처 선택 시 → 확정 상태 견적서 목록 표시
- 선택 시 → 품목 및 단가 자동 반영
- 수량만 수정하여 신규 발주/판매 생성

#### 1.1.5 Excel/PDF 업로드 (무료 기능)
```yaml
Upload Flow:
  1. Excel/PDF 파일 업로드
  2. 파싱: 품목명, 수량, 단가 추출
  3. 매핑: 기존 품목과 자동 매칭
  4. 검토: 사용자 확인/수정
  5. 저장: 품목 리스트에 반영
```

---

### 1.2 계약서 (Contract)

#### 1.2.1 계약서 입력
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 거래처 | Select | ✓ | 계약 대상 |
| 계약 기간 | DateRange | ✓ | 시작일 ~ 종료일 |
| 적용 품목 | Multi-Select | ✓ | 계약 적용 품목 |
| 계약 단가 | Currency | ✓ | 품목별 계약가 |
| 할인 조건 | Text | - | 할인율, 조건 등 |
| 특이사항 | Text | - | 추가 계약 조건 |

#### 1.2.2 계약서 관리
| 기능 | 설명 |
|------|------|
| 회사별 정렬 | 거래처별 계약서 그룹핑 |
| 조건 검색 | 계약 기간, 품목, 금액 범위 검색 |
| 유효 계약 표시 | 현재 유효한 계약 하이라이트 |
| 종료 알림 | 계약 만료 30일/7일 전 알림 |

#### 1.2.3 계약서 상태
```
작성 → 검토중 → 체결 → 유효 → 만료
                 ↓
              거절/취소
```

---

### 1.3 단가 관리 (Price Management)

#### 1.3.1 핵심 원칙
| 원칙 | 설명 |
|------|------|
| **Private** | 거래처별 단가 완전 분리 |
| **이력 관리** | 모든 단가 변경 이력 저장 |
| **외부 노출 없음** | 병원 간 단가 비교 불가 |

#### 1.3.2 단가 조회 화면
```
┌─────────────────────────────────────────────────────────┐
│ 거래처: [A병원 ▼]                                        │
├─────────────────────────────────────────────────────────┤
│ 품목명      │ 현재 단가  │ 적용일     │ 이력 │ 출처     │
├─────────────┼────────────┼────────────┼──────┼──────────┤
│ 테이프 10EA │ ₩3,500    │ 2025-01-15 │ [▶]  │ 견적#123 │
│ 거즈 1BOX   │ ₩12,000   │ 2025-01-10 │ [▶]  │ 계약#45  │
└─────────────────────────────────────────────────────────┘
```

#### 1.3.3 최소 단가 설정 (검토중)
```yaml
MinPrice Rule:
  - 품목별 최소 판매가 설정
  - 최소가 이하 입력 시 → 경고 + 승인 필요
  - 관리자만 최소가 이하 승인 가능
```

---

## 2. 발주 관리 (Order Management)

> **흐름**: 병원 → 본사/도매

### 2.1 발주 입력

#### 2.1.1 입력 방식
| 방식 | 설명 | 대상 |
|------|------|------|
| Excel 업로드 | 표준 양식 업로드 | 개인/법인 |
| 품목 불러오기 | 거래처별 품목 리스트에서 선택 | 개인/법인 |
| 직접 입력 | 품목/수량 직접 입력 | 개인/법인 |
| 메일 자동발송 | 발주서 이메일 발송 (Premium) | 법인 |

#### 2.1.2 발주 입력 필드
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 발주처 | Select | ✓ | 주문 대상 업체 |
| 품목 | Multi-Select | ✓ | 발주 품목 |
| 수량 | Number | ✓ | 품목별 수량 |
| 발송일 | Date | ✓ | 기본: 현재 날짜 |
| 희망 납품일 | Date | - | 납품 희망일 |

#### 2.1.3 품목 불러오기 UX
```
┌─────────────────────────────────────────────────────────┐
│ 발주처: [A도매 ▼]    [자주 시키는 품목 ▼]              │
├─────────────────────────────────────────────────────────┤
│ ☑ 테이프 10EA    │ 단가: ₩3,500  │ 수량: [___10___]   │
│ ☑ 거즈 1BOX      │ 단가: ₩12,000 │ 수량: [____5___]   │
│ ☐ 주사기 100EA   │ 단가: ₩8,000  │ 수량: [________]   │
├─────────────────────────────────────────────────────────┤
│                              합계: ₩95,000  [발주하기] │
└─────────────────────────────────────────────────────────┘
```

### 2.2 발주 관리

#### 2.2.1 발주 상태 머신
```
┌─────────┐    승인요청    ┌───────────┐    승인     ┌─────────┐
│  요청   │ ────────────▶ │ 승인대기  │ ─────────▶ │  승인   │
└─────────┘               └───────────┘            └─────────┘
     │                          │                       │
     │ (개인용)                 │ 반려                   │ 납품완료
     ▼                          ▼                       ▼
┌─────────┐               ┌───────────┐            ┌─────────┐
│  완료   │               │   반려    │            │  완료   │
└─────────┘               └───────────┘            └─────────┘
```

| 상태 | 개인용 | 교류(B2B) | 설명 |
|------|--------|-----------|------|
| 요청 (Requested) | ✓ | ✓ | 발주 생성 |
| 승인대기 (Pending) | - | ✓ | 상대방 승인 대기 |
| 승인 (Approved) | - | ✓ | 발주 승인됨 |
| 완료 (Completed) | ✓ | ✓ | 납품 완료 |
| 반려 (Rejected) | - | ✓ | 발주 거절 |

#### 2.2.2 발주 관리 필터
- 업체별 / 품목별 / 날짜별
- 상태별 필터
- 엑셀 내보내기

### 2.3 발주 승인 조건 (Premium)

```yaml
Approval Rules:
  병원별:
    - A병원: 자동 승인 (VIP)
    - B병원: 100만원 이상 → 관리자 승인

  금액별:
    - 50만원 미만: 자동 승인
    - 50만원 이상: 팀장 승인
    - 500만원 이상: 대표 승인

  품목별:
    - 일반 품목: 자동 승인
    - 고가 품목: 승인 필요
```

### 2.4 발주 현황

#### 2.4.1 일별 발주 예정
```
┌─────────────────────────────────────────────────────────┐
│ 2025년 1월 22일 (수)                                     │
├─────────────────────────────────────────────────────────┤
│ 시간  │ 병원      │ 품목          │ 수량 │ 상태       │
├───────┼───────────┼───────────────┼──────┼────────────┤
│ 09:00 │ A병원     │ 테이프 10EA   │ 100  │ 납품예정   │
│ 10:30 │ B의원     │ 거즈 1BOX     │ 50   │ 출고중     │
│ 14:00 │ C병원     │ 주사기 100EA  │ 20   │ 대기       │
└─────────────────────────────────────────────────────────┘
```

#### 2.4.2 납품 예정 캘린더
- 완료 상태 발주만 표시
- 월간/주간 뷰 제공
- 드래그로 일정 변경

---

## 3. 구매 관리 (Purchase Management)

> **원칙**: 발주 "완료" 상태만 자동 연계

### 3.1 구매 입력

#### 3.1.1 자동 생성 (권장)
```yaml
Auto Generation:
  Trigger: 발주 상태 → 완료
  Action:
    - 구매 레코드 자동 생성
    - 발주 정보 복사 (품목, 수량, 단가)
    - 상태: 생성됨
```

#### 3.1.2 수동 입력 (예외)
- 발주 없이 직접 구매한 경우
- 긴급 구매

### 3.2 구매 관리

#### 3.2.1 구매 상태 머신
```
발주완료 → 구매생성 → 입고대기 → 입고완료 → 검수완료
                                    ↓
                               불량/반품
```

#### 3.2.2 발주-구매 자동 전환
| 발주 상태 | 구매 동작 |
|-----------|-----------|
| 완료 | 구매 레코드 자동 생성 |
| 취소 | 구매 레코드 생성 안함 |

### 3.3 구매 현황
- 업체별 / 품목별 / 날짜별 리스트
- 구매 금액 집계
- 월별 구매 추이 차트

### 3.4 거래명세표 (입고 시) - Premium

#### 3.4.1 자동 업로드
```yaml
On Sale (발주서 확인 시):
  1. 거래명세표 자동 생성
  2. 품목/수량/단가 자동 입력
  3. 상태: 생성
```

#### 3.4.2 거래명세표 상태
```
생성 → 발송 → 승인
        ↓
      반려 → 수정 → 재발송
```

---

## 4. 판매 관리 (Sales Management)

> **병원 기준 판매 관리**

### 4.1 판매 자동 등록 흐름

```
발주 요청 → 재고 확인 → 수량 있음 → 판매 자동 등록
     ↓                      ↓
  알림 발송            수량 부족 → 알림
```

### 4.2 판매 입력

#### 4.2.1 입력 방식 (우선순위)
| 순위 | 방식 | 설명 |
|------|------|------|
| 1 | 자동 등록 | 발주 요청 기반 자동 생성 |
| 2 | 품목 불러오기 | 품목관리 리스트에서 선택, 수량만 변경 |
| 3 | Excel 업로드 | 표준 양식 업로드 |
| 4 | 수동 입력 | 직접 입력 (최소화) |

#### 4.2.2 출고자 UX
```
┌─────────────────────────────────────────────────────────┐
│ 거래처: [A병원 ▼]    [자주 나가는 품목 ▼]  [Excel 업로드]│
├─────────────────────────────────────────────────────────┤
│ ☑ 테이프 10EA    │ 재고: 500  │ 수량: [___50___]       │
│ ☑ 거즈 1BOX      │ 재고: 200  │ 수량: [___20___]       │
│ ☐ 주사기 100EA   │ 재고: 0 ⚠️ │ 수량: [________]       │
├─────────────────────────────────────────────────────────┤
│                              합계: ₩415,000 [판매등록] │
└─────────────────────────────────────────────────────────┘
```

### 4.3 거래명세표 발급

```yaml
After 판매 등록:
  1. 거래명세표 자동 생성
  2. 발급 버튼 클릭
  3. 거래명세표 발송 (이메일/출력)
```

### 4.4 판매 관리

#### 4.4.1 업체별 판매 이력
- 거래처별 판매 내역
- 품목별 매출 집계
- 기간별 비교

#### 4.4.2 판매 상태
```
예정 → 확정 → 정산대기 → 정산완료
  ↓
취소
```

| 상태 | 설명 |
|------|------|
| 예정 (Scheduled) | 판매 예약됨 |
| 확정 (Confirmed) | 출고 완료 |
| 정산대기 (PendingSettlement) | 미수금 상태 |
| 정산완료 (Settled) | 입금 확인 |
| 취소 (Cancelled) | 판매 취소 |

### 4.5 과거 데이터 복원

#### 4.5.1 Excel/CSV 업로드
```yaml
Upload:
  - 지원: 5년치 데이터
  - 형식: Excel (.xlsx), CSV
  - 용량: 최대 100MB/파일

Processing:
  1. RAW 데이터 저장 (원본 보존)
  2. 자동 매핑 시도
  3. 매핑 실패 → 수동 매핑 UI
  4. 검증 완료 → 읽기 전용 저장
```

#### 4.5.2 과거 문서 특성
| 특성 | 설명 |
|------|------|
| 읽기 전용 | 수정 불가 |
| 라벨 표시 | [과거 데이터] 표시 |
| 검색 가능 | 일반 검색에 포함 |
| 정산 제외 | 현재 정산에 미포함 |

---

## 5. 입출고 / 재고 관리

### 5.1 입출고 관리

#### 5.1.1 자동 반영 규칙
| 이벤트 | 재고 동작 |
|--------|-----------|
| 구매 확정 | 입고 자동 반영 (+) |
| 판매 확정 | 출고 자동 반영 (-) |
| 불량 등록 | 재고 차감 (-) |
| 반품 처리 | 재고 복원 (+) |

#### 5.1.2 재고 유형
```
┌─────────────────────────────────────────────────────────┐
│ 품목: 테이프 10EA                                        │
├─────────────────────────────────────────────────────────┤
│ 확정 재고    │ 500 EA  │ 실제 보유량                    │
│ 예정 입고    │ +100 EA │ 입고 예정 (발주 승인)          │
│ 예정 출고    │ -50 EA  │ 출고 예정 (판매 예정)          │
│ 가용 재고    │ 550 EA  │ 확정 + 예정입고 - 예정출고     │
└─────────────────────────────────────────────────────────┘
```

### 5.2 불량 관리

#### 5.2.1 불량 등록
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 품목 | Select | ✓ | 불량 품목 |
| 수량 | Number | ✓ | 불량 수량 |
| 발견일 | Date | ✓ | 불량 발견일 |
| 원인 | Select | ✓ | 제조불량/운송파손/보관불량 |
| 책임 | Select | ✓ | 공급업체/자사/운송사 |
| 처리방법 | Select | ✓ | 재출고/환불/폐기 |
| 사진 | File | - | 불량 증거 사진 |

#### 5.2.2 불량 처리 흐름
```
불량 발견 → 등록 → 원인 분석 → 책임 구분 → 처리
                                           ↓
                              ┌────────────┼────────────┐
                              ▼            ▼            ▼
                           재출고        환불         폐기
```

---

## 6. 채권 관리 (Accounts Receivable)

> **병원 미수금 관리**

### 6.1 미수금 현황

#### 6.1.1 병원별 미수금
```
┌─────────────────────────────────────────────────────────┐
│ 전체 미수금: ₩45,230,000                    [엑셀 내보내기]│
├─────────────────────────────────────────────────────────┤
│ 병원      │ 미수금      │ 연체금액    │ 연체일 │ 상태   │
├───────────┼─────────────┼─────────────┼────────┼────────┤
│ A병원     │ ₩12,500,000 │ ₩0          │ -      │ 정상   │
│ B의원     │ ₩8,730,000  │ ₩2,100,000  │ 15일   │ ⚠️ 연체 │
│ C병원     │ ₩24,000,000 │ ₩5,000,000  │ 45일   │ 🔴 위험 │
└─────────────────────────────────────────────────────────┘
```

### 6.2 자동 집계

#### 6.2.1 집계 기준
| 기준 | 설명 |
|------|------|
| 거래명세표 | 발송된 거래명세표 기준 |
| 판매 확정 | 확정된 판매 기준 |
| 입금 반영 | 입금 확인 시 자동 차감 |

#### 6.2.2 집계 공식
```
미수금 = Σ(판매확정 금액) - Σ(입금 확인 금액)
```

### 6.3 연체 알림

| 연체 기간 | 알림 방식 | 대상 |
|-----------|-----------|------|
| 7일 전 | 이메일 | 담당자 |
| 당일 | 이메일 + 알림 | 담당자 + 관리자 |
| 7일 후 | 이메일 + SMS | 관리자 |
| 30일 후 | 경고 표시 | 전체 |

### 6.4 입금 확인

```yaml
On Payment:
  1. 입금 내역 등록
  2. 해당 거래와 매칭
  3. 미수금 자동 차감
  4. 판매 상태 → 정산완료
```

---

## 7. 세금계산서

### 7.1 자동 생성

#### 7.1.1 생성 기준
| 기준 | 설명 |
|------|------|
| 판매 확정 | 확정된 판매 건 기준 |
| 월별 집계 | 월 단위 합산 |
| 거래처별 | 거래처별 개별 발행 |

#### 7.1.2 생성 시점
```yaml
Options:
  - 건별 발행: 판매 확정 즉시
  - 월별 합산: 매월 말일 자동
  - 수동 발행: 사용자 요청 시
```

### 7.2 세금계산서 관리

```
┌─────────────────────────────────────────────────────────┐
│ 2025년 1월 세금계산서                                    │
├─────────────────────────────────────────────────────────┤
│ 거래처    │ 공급가액     │ 세액        │ 상태    │ 발행  │
├───────────┼──────────────┼─────────────┼─────────┼───────┤
│ A병원     │ ₩10,000,000  │ ₩1,000,000  │ 발행완료│ [보기]│
│ B의원     │ ₩5,500,000   │ ₩550,000    │ 미발행  │ [발행]│
└─────────────────────────────────────────────────────────┘
```

### 7.3 외부 연동 (Premium)

| 연동 대상 | 기능 |
|-----------|------|
| 홈택스 | 전자세금계산서 직접 발행 |
| ERP | 회계 시스템 연동 |
| 이메일 | 자동 발송 |

---

## 8. 관리 체계 / 권한

### 8.1 사용자 유형

| 유형 | 설명 | 주요 권한 |
|------|------|-----------|
| 병원 | 발주 요청자 | 발주, 납품확인 |
| 본사 | 전체 관리자 | 모든 기능 |
| 물류 | 입출고 담당 | 재고, 배송 |
| 관리자 | 시스템 관리 | 권한, 설정 |

### 8.2 권한 매트릭스

| 기능 | 병원 | 본사 | 물류 | 관리자 |
|------|------|------|------|--------|
| 견적서 조회 | ○ | ○ | - | ○ |
| 견적서 작성 | - | ○ | - | ○ |
| 단가 조회 | 본인만 | ○ | - | ○ |
| 계약서 조회 | 본인만 | ○ | - | ○ |
| 발주 요청 | ○ | ○ | - | ○ |
| 발주 승인 | - | ○ | - | ○ |
| 구매 관리 | - | ○ | ○ | ○ |
| 판매 관리 | - | ○ | ○ | ○ |
| 재고 조회 | - | ○ | ○ | ○ |
| 재고 수정 | - | - | ○ | ○ |
| 채권 조회 | - | ○ | - | ○ |
| 정산 처리 | - | ○ | - | ○ |
| 사용자 관리 | - | - | - | ○ |
| 권한 설정 | - | - | - | ○ |

### 8.3 권한별 접근 제한

| 데이터 | 제한 규칙 |
|--------|-----------|
| 단가 | 거래처별 완전 분리, 타 거래처 단가 열람 불가 |
| 계약서 | 당사자만 열람 가능 |
| 정산 | 관리자/본사만 접근 |
| 감사 로그 | 관리자만 접근 |

---

## 9. 일별 납품 현황 (메디칼 특화)

### 9.1 오늘 납품 예정

```
┌─────────────────────────────────────────────────────────┐
│ 2025년 1월 22일 (수) 납품 예정                           │
│ 총 15건 │ 완료: 8건 │ 진행중: 5건 │ 대기: 2건           │
├─────────────────────────────────────────────────────────┤
│ 시간  │ 병원     │ 품목              │ 수량 │ 출고상태  │
├───────┼──────────┼───────────────────┼──────┼───────────┤
│ 09:00 │ A병원    │ 테이프 10EA       │ 100  │ ✅ 완료   │
│ 09:30 │ A병원    │ 거즈 1BOX         │ 50   │ ✅ 완료   │
│ 10:00 │ B의원    │ 주사기 100EA      │ 30   │ 🔄 진행중 │
│ 11:00 │ C병원    │ 소독약 500ml      │ 20   │ ⏳ 대기   │
└─────────────────────────────────────────────────────────┘
```

### 9.2 기사/물류용 화면

#### 9.2.1 물류 대시보드
```
┌─────────────────────────────────────────────────────────┐
│ 📦 오늘 배송                                  [새로고침] │
├─────────────────────────────────────────────────────────┤
│ 배송 완료: 8/15건                    [지도 보기]         │
│ ████████░░░░░░░ 53%                                    │
├─────────────────────────────────────────────────────────┤
│ 다음 배송: B의원 (10:00)                                │
│ 품목: 주사기 100EA x 30                                 │
│ 주소: 서울시 강남구 테헤란로 123                         │
│ [네비게이션] [배송완료]                                  │
└─────────────────────────────────────────────────────────┘
```

#### 9.2.2 기사 전용 앱 기능
| 기능 | 설명 |
|------|------|
| 배송 목록 | 오늘 배송 예정 리스트 |
| 순서 최적화 | 배송 경로 자동 최적화 |
| 실시간 상태 | 배송 상태 실시간 업데이트 |
| 서명 수집 | 수령인 서명 캡처 |
| 사진 촬영 | 배송 완료 증거 사진 |

---

## 10. 품목 관리 (Product Master)

> **핵심 원칙**: 내 품목 등록 (사는것/파는것) → 모달에서 선택 → 발주/판매/견적 공통 적용
> **상세 명세**: `docs/features/05-product-master.md`

### 10.1 품목 유형

| 유형 | 아이콘 | 설명 | 사용 화면 |
|------|--------|------|-----------|
| **구매 품목** | 📥 | 다른 업체에서 사는 품목 | 발주 |
| **판매 품목** | 📤 | 다른 업체에 파는 품목 | 판매, 견적서, 재고 |
| **둘다** | ↔️ | 사기도 팔기도 하는 품목 | 모든 화면 |

### 10.2 품목 관리 화면

```
┌─────────────────────────────────────────────────────────────────────┐
│  품목 관리                                           [+ 품목 등록]  │
├─────────────────────────────────────────────────────────────────────┤
│  [전체] [📥구매품목] [📤판매품목] [↔️둘다]           [🔍 검색...]   │
├─────────────────────────────────────────────────────────────────────┤
│  │유형│ 코드   │ 품목명      │ 규격  │ 단위│ 단가   │ 상태  │      │
│  │📥 │ P-001  │ 원재료A     │ 대용량│ KG  │ ₩50,000│ 활성  │      │
│  │📤 │ P-002  │ 테이프 10EA │ 의료용│ EA  │ ₩3,500 │ 활성  │      │
│  │↔️ │ P-003  │ 주사기 100EA│ 일반  │ EA  │ ₩8,000 │ 활성  │      │
└─────────────────────────────────────────────────────────────────────┘
```

### 10.3 품목 선택 모달 (공통 컴포넌트)

| 호출 화면 | 모달 필터 | 표시 정보 |
|-----------|-----------|-----------|
| 발주 | 📥 구매 품목 (Buy + Both) | 구매 단가, 거래처 |
| 판매 | 📤 판매 품목 (Sell + Both) | 판매 단가, 재고 |
| 견적서 | 📤 판매 품목 (Sell + Both) | 판매 단가 |

### 10.4 품목 데이터 모델

```csharp
public class Product
{
    public int Id { get; set; }
    public string Code { get; set; }
    public string Name { get; set; }
    public ProductTransactionType TransactionType { get; set; }  // Buy, Sell, Both
    public decimal? DefaultPrice { get; set; }      // 판매 단가
    public decimal? PurchasePrice { get; set; }     // 구매 단가
    public int CompanyId { get; set; }              // 소속 업체
    // ...
}
```

---

## 11. 발주자/출고자 워크플로우

### 11.1 발주자 워크플로우 (탭 기반)

```
┌─────────────────────────────────────────────────────────────────┐
│  [+ 거래처 선택]  [A도매 ✕]                                      │
├─────────────────────────────────────────────────────────────────┤
│  A도매 - 발주관리                                    [새 발주]   │
├─────────────────────────┬───────────────────────────────────────┤
│  📦 품목 리스트         │  ⭐ 최근거래 품목 (자주 시키는 품목)   │
│  [품목 검색...]         │                                       │
│  ☐ 테이프 10EA ₩3,500  │  ☑ 테이프 10EA  수량: [___100___]     │
│  ☐ 거즈 1BOX   ₩12,000 │  ☑ 거즈 1BOX    수량: [____50___]     │
│  ☐ 주사기 100EA ₩8,000 │  ☐ 주사기 100EA 수량: [_________]     │
│                         │  ────────────────────────────────     │
│                         │  합계: ₩950,000                       │
│                         │  [임시저장]  [발주서 보내기]           │
├─────────────────────────┴───────────────────────────────────────┤
│  📋 최근 거래 내역                                               │
│  [등록]  [최근 작업 (임시저장)]  [최근 성사 내역]                │
│  ─────────────────────────────────────────────────────────────  │
│  │ 📝 임시저장 #1 (01-22 14:30) │ 테이프 × 100, 거즈 × 50      │
│  │    합계: ₩950,000            │ [불러오기] [삭제]             │
│  │ 📝 임시저장 #2 (01-21 16:20) │ 주사기 × 200                  │
│  │    합계: ₩1,600,000          │ [불러오기] [삭제]             │
└─────────────────────────────────────────────────────────────────┘
```

**발주 흐름:**
1. **[+ 거래처 선택]** → 2컬럼 거래처 리스트 → 업체명 검색 → 거래처 클릭
2. **상세화면 진입** → 3분할 레이아웃 (품목 | 최근거래품목 | 최근내역)
3. **최근거래 품목에서 수량만 입력** → [임시저장] 클릭 → 최근 작업 탭에 반영
4. **최근 작업 탭에서 [불러오기]** → 등록 탭으로 이동
5. **[발주서 보내기]** → 발주 확정 → 최근 성사 내역에 반영

### 11.2 출고자 워크플로우 (탭 기반)

```
┌─────────────────────────────────────────────────────────────────┐
│  [+ 거래처 선택]  [A병원 ✕]                                      │
├─────────────────────────────────────────────────────────────────┤
│  A병원 - 판매관리                                    [새 판매]   │
├─────────────────────────┬───────────────────────────────────────┤
│  📦 품목 리스트         │  ⭐ 자주 나가는 품목                   │
│  [품목 검색...]         │                                       │
│  ☐ 테이프 10EA 재고:500│  ☑ 테이프 10EA  수량: [____50___]     │
│  ☐ 거즈 1BOX   재고:200│  ☑ 거즈 1BOX    수량: [____20___]     │
│  ☐ 주사기 100EA 재고:0⚠️│  ☐ 주사기 100EA 수량: [_________]     │
│                         │  ────────────────────────────────     │
│  [Excel 업로드]         │  합계: ₩415,000                       │
│                         │  [임시저장]  [판매 등록]               │
├─────────────────────────┴───────────────────────────────────────┤
│  📋 최근 거래 내역                                               │
│  [등록]  [최근 작업 (임시저장)]  [최근 성사 내역]                │
│  ─────────────────────────────────────────────────────────────  │
│  │ 날짜       │ 문서번호      │ 품목요약        │ 금액    │상태│
│  │ 2025-01-20 │ SA-0120-0001 │ 테이프 외 2건   │ ₩850,000│✅  │
│  │ 2025-01-15 │ SA-0115-0002 │ 거즈 외 1건     │ ₩600,000│✅  │
└─────────────────────────────────────────────────────────────────┘
```

**판매 흐름:**
1. **[+ 거래처 선택]** → 거래처 리스트 → 병원 클릭
2. **자주 나가는 품목에서 수량 입력** (재고 실시간 확인)
3. **[임시저장]** 또는 바로 **[판매 등록]**
4. 판매 등록 완료 → **거래명세표 자동 발급**

### 11.3 임시저장 시스템

| 기능 | 설명 |
|------|------|
| **자동 저장** | 품목/수량 입력 시 자동 임시저장 (옵션) |
| **불러오기** | 최근 작업에서 선택 → 등록 탭으로 복원 |
| **정렬** | 최신순/금액순 정렬 |
| **삭제** | 개별/전체 삭제 |
| **만료** | 30일 후 자동 삭제 (설정 가능) |

---

## Appendix A: 기능 분류 (Free vs Premium)

### Free 기능
| 카테고리 | 기능 |
|----------|------|
| 서류관리 | 견적서, 계약서 기본 관리 |
| 발주 | 발주 입력, Excel 업로드 |
| 구매 | 구매 관리 기본 |
| 판매 | 판매 관리 기본 |
| 재고 | 재고 조회 |
| 내보내기 | Excel 다운로드 |

### Premium 기능
| 카테고리 | 기능 |
|----------|------|
| 서류관리 | 단가 정책 자동 반영, 최소단가 설정 |
| 발주 | 승인 조건 설정, 메일 자동발송 |
| 구매 | 거래명세표 자동 업로드 |
| 정산 | 연체 알림, 자동 집계 |
| 세금계산서 | 홈택스 연동, 자동 발행 |
| 물류 | 기사용 앱, 경로 최적화 |
| 내보내기 | PDF 내보내기 |

---

## Appendix B: 상태 머신 정의

### B.1 견적서 상태
```csharp
public enum QuotationState
{
    Draft,           // 작성
    Sent,            // 발송
    UnderReview,     // 수신 검토중
    Confirmed,       // 확정
    RevisionRequested // 수정요청
}
```

### B.2 발주 상태
```csharp
public enum OrderState
{
    Requested,       // 요청
    PendingApproval, // 승인대기
    Approved,        // 승인
    Completed,       // 완료
    Rejected         // 반려
}
```

### B.3 판매 상태
```csharp
public enum SaleState
{
    Scheduled,          // 예정
    Confirmed,          // 확정
    PendingSettlement,  // 정산대기
    Settled,            // 정산완료
    Cancelled           // 취소
}
```

### B.4 구매 상태
```csharp
public enum PurchaseState
{
    Created,         // 생성됨
    PendingDelivery, // 입고대기
    Delivered,       // 입고완료
    Inspected,       // 검수완료
    Defective        // 불량/반품
}
```

### B.5 품목 거래 유형
```csharp
public enum ProductTransactionType
{
    Buy,    // 📥 구매 품목 (사는 품목) - 발주에서 사용
    Sell,   // 📤 판매 품목 (파는 품목) - 판매/견적서에서 사용
    Both    // ↔️ 구매+판매 (사기도 팔기도) - 모든 화면에서 사용
}
```

---

## Appendix C: 데이터 모델 (Entity)

### C.1 Core Entities

```
┌─────────────────┐     ┌─────────────────────┐
│    Company      │     │      Product        │
├─────────────────┤     ├─────────────────────┤
│ Id              │     │ Id                  │
│ Name            │     │ Name                │
│ Type            │     │ Code                │
│ Address         │     │ TransactionType     │  ← Buy/Sell/Both
│ Contact         │     │ DefaultPrice        │  ← 판매가
└────────┬────────┘     │ PurchasePrice       │  ← 구매가
         │              │ CompanyId           │  ← 소속 업체
         │              │ Unit, Category      │
         │              └──────────┬──────────┘
         │    ┌────────────────────┤
         │    │                    │
         ▼    ▼                    ▼
┌─────────────────┐     ┌─────────────────┐
│  CompanyPrice   │     │   Quotation     │
├─────────────────┤     ├─────────────────┤
│ CompanyId       │     │ Id              │
│ ProductId       │     │ CompanyId       │
│ UnitPrice       │     │ State           │
│ EffectiveDate   │     │ ValidUntil      │
│ Source          │     │ Items[]         │
└─────────────────┘     └─────────────────┘

┌─────────────────┐     ┌─────────────────┐
│     Order       │     │    Purchase     │
├─────────────────┤     ├─────────────────┤
│ Id              │     │ Id              │
│ CompanyId       │     │ OrderId         │
│ State           │     │ State           │
│ OrderDate       │     │ Items[]         │
│ Items[]         │     └─────────────────┘
└─────────────────┘

┌─────────────────┐     ┌─────────────────┐
│      Sale       │     │    Inventory    │
├─────────────────┤     ├─────────────────┤
│ Id              │     │ ProductId       │
│ CompanyId       │     │ ConfirmedQty    │
│ State           │     │ PendingInQty    │
│ Items[]         │     │ PendingOutQty   │
└─────────────────┘     └─────────────────┘
```

---

## Version History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-01-01 | - | 초기 버전 (거래명세표 중심) |
| 2.0 | 2025-01-22 | - | 전체 기능 확장 (견적~정산) |
