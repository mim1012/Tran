<Window x:Class="Tran.Desktop.SettlementManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="정산 관리 (읽기 전용)" Height="700" Width="1100"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">

    <Window.Resources>
        <!-- BoolToVisibility Converter -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 상단 안내 배너 (읽기 전용) -->
        <Border Grid.Row="0" Background="#E8EAF6" Padding="15" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <Border Background="#5C6BC0"
                       CornerRadius="6"
                       Padding="10,5"
                       Margin="0,0,15,0">
                    <TextBlock Text="READ ONLY"
                             Foreground="White"
                             FontSize="12"
                             FontWeight="Bold"/>
                </Border>
                <TextBlock Text="이 화면은 확정된 문서의 집계를 조회하는 읽기 전용 화면입니다"
                         Foreground="#5C6BC0"
                         VerticalAlignment="Center"
                         FontSize="13"/>
            </StackPanel>
        </Border>

        <!-- 기간 선택 영역 -->
        <Border Grid.Row="1" Background="White" Padding="20" Margin="10,0,10,10"
                BorderBrush="#E0E0E0" BorderThickness="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- From Date -->
                <TextBlock Grid.Column="0" Text="조회 기간"
                          FontWeight="Bold"
                          VerticalAlignment="Center"
                          Margin="0,0,15,0"/>

                <DatePicker Grid.Column="1"
                           SelectedDate="{Binding FromDate, Mode=TwoWay}"
                           Width="150"
                           Margin="0,0,10,0"/>

                <TextBlock Grid.Column="2" Text="~"
                          VerticalAlignment="Center"
                          Margin="0,0,10,0"/>

                <!-- To Date -->
                <DatePicker Grid.Column="3"
                           SelectedDate="{Binding ToDate, Mode=TwoWay}"
                           Width="150"
                           Margin="0,0,20,0"/>

                <!-- 조회 버튼 -->
                <Button Grid.Column="5"
                       Content="조회"
                       Command="{Binding LoadSummariesCommand}"
                       Background="#1E7F34"
                       Foreground="White"
                       Padding="25,8"
                       BorderThickness="0"
                       FontWeight="Bold"
                       Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                               CornerRadius="4"
                                               Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#27AE60"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Background" Value="#BDC3C7"/>
                                    <Setter Property="Cursor" Value="Arrow"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>
        </Border>

        <!-- 거래처별 집계 DataGrid -->
        <Border Grid.Row="2" Background="White" Padding="20" Margin="10,0,10,10"
                BorderBrush="#E0E0E0" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="거래처별 집계"
                          FontSize="16" FontWeight="Bold"
                          Margin="0,0,0,15"/>

                <DataGrid Grid.Row="1"
                         ItemsSource="{Binding Summaries}"
                         SelectedItem="{Binding SelectedSummary, Mode=TwoWay}"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         SelectionMode="Single"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False"
                         CanUserReorderColumns="False"
                         GridLinesVisibility="Horizontal"
                         HeadersVisibility="Column"
                         AlternatingRowBackground="#F9F9F9"
                         RowHeight="40">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="거래처명" Binding="{Binding CompanyName}" Width="*" MinWidth="150">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="총 거래건수" Binding="{Binding TotalCount, StringFormat={}{0:N0}건}" Width="150">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                    <Setter Property="TextAlignment" Value="Right"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="총 금액" Binding="{Binding TotalAmount, StringFormat={}{0:N0}원}" Width="200">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                    <Setter Property="TextAlignment" Value="Right"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="Foreground" Value="#1E7F34"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="평균 금액" Binding="{Binding AverageAmount, StringFormat={}{0:N0}원}" Width="200">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                    <Setter Property="TextAlignment" Value="Right"/>
                                    <Setter Property="Foreground" Value="#666"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Cursor" Value="Hand"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#E6F4EA"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#C8E6C9"/>
                                    <Setter Property="Foreground" Value="Black"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
            </Grid>
        </Border>

        <!-- 구분선 -->
        <Border Grid.Row="3" Background="#E0E0E0" Height="1" Margin="10,0"/>

        <!-- 선택된 거래처의 문서 목록 DataGrid -->
        <Border Grid.Row="4" Background="White" Padding="20" Margin="10,10,10,10"
                BorderBrush="#E0E0E0" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                    <TextBlock Text="문서 목록"
                              FontSize="16" FontWeight="Bold"
                              VerticalAlignment="Center"/>
                    <TextBlock Text=" (더블클릭하여 상세 보기)"
                              FontSize="12"
                              Foreground="#999"
                              VerticalAlignment="Center"
                              Margin="10,0,0,0"/>
                </StackPanel>

                <DataGrid Grid.Row="1"
                         ItemsSource="{Binding Documents}"
                         SelectedItem="{Binding SelectedDocument, Mode=TwoWay}"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         SelectionMode="Single"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False"
                         CanUserReorderColumns="False"
                         GridLinesVisibility="Horizontal"
                         HeadersVisibility="Column"
                         AlternatingRowBackground="#F9F9F9"
                         RowHeight="35"
                         MouseDoubleClick="DocumentsDataGrid_MouseDoubleClick">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="문서번호" Binding="{Binding DocumentId}" Width="250">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                    <Setter Property="FontFamily" Value="Consolas"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="거래일" Binding="{Binding TransactionDate, StringFormat=yyyy-MM-dd}" Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="금액" Binding="{Binding TotalAmount, StringFormat={}{0:N0}원}" Width="*" MinWidth="150">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                    <Setter Property="TextAlignment" Value="Right"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="Foreground" Value="#1E7F34"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="확정일시" Binding="{Binding ConfirmedAt, StringFormat=yyyy-MM-dd HH:mm}" Width="150">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                    <Setter Property="Foreground" Value="#666"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <DataGridTextColumn Header="상태" Binding="{Binding State}" Width="100">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Padding" Value="10,0"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                    <Setter Property="Background" Value="#E6F4EA"/>
                                    <Setter Property="Foreground" Value="#1E7F34"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Cursor" Value="Hand"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F0F0F0"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
            </Grid>
        </Border>

        <!-- 로딩 오버레이 -->
        <Border Grid.RowSpan="5"
               Background="#80000000"
               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="데이터 로딩 중..."
                         Foreground="White"
                         FontSize="18"
                         FontWeight="Bold"
                         HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
